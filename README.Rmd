---
title: "LibBookLC"
author: "Tomasz Dulski"
date: "2024-03-28"
output: html_document
---

## Introduction

<p align="justify"> This package was created to extract the data from [Lubimy CzytaÄ‡](https://lubimyczytac.pl/) which is a popular website in Poland for building your library of books. The website does not have an option to extract the library to file. Thus, if you want to transfer your library in third part services, like more international one [Good reads](https://www.goodreads.com/), you have to do it manually book by book. I decided to make a package that scrap the information of books from polish library website and format data to table file structure required by Good Reads.
 </p>
## Additional details

<p align="justify">
Scrapping time depends on the library size. Averagely, it takes around 10 minutes for 600 books.
</p>

The script extract the following fields:

1. Title
2. Author
3. Main shelf of book
4. Date read
5. Given rate
6. User review
7. Book ISBN number

## Instalation

<p align="justify">
Check if you have devtools package, if not install it by typing: 
`install.packages("devtools")`
Then install package LibBookLC:
`devtools::install_github('TomaszDulski/LibBookLC')`
Remember to load the package after installation:
`library("LibBookLC")`
</p>

## Input 

<p align="justify">
As an input user should provide individual link to the own library that can be generated by the user after log in as in the example below:

![](put link)

</p>

## Getting ready

<p align="justify">

The package has been written in R and minimal knowledge of R is required to successfully complete 
the script.

</p>

### The enviroment 

<p align="justify">

Package utilize `RSelenium` package.Thus user must verify the google chrome version and download the respective chromedriver.

1. Driver can be downloaded from the following page: [https://googlechromelabs.github.io/chrome-for-testing/](https://googlechromelabs.github.io/chrome-for-testing/)
2. Make sure java is installed. 

</p>

### Initialize 

<p align="justify">

This step aims to initialize required driver directory skeleton.
After running this chunk, error may occur but you should wait until all necessary files 
are downloaded. At the end, inspect your local directory in terms of presence of binman directories.

Especially pay attention if the `binman_chromdriver` subdirectory was created:

Windows: `C:\Users\USER\AppData\Local\binman` with several other binman directories
Unix: `~/.local/share/binman_chromedriver/`

</p>

```{r, message=TRUE, error=FALSE, warning=FALSE, eval=F, echo=T}
install.packages("RSelenium")
library(RSelenium)

rD <- rsDriver() # runs a chrome browser, wait for necessary files to download
```

### Confirm chromedriver version

<p align="justify">

1. Check your google chrome version by typing in the url field `chrome://version/`
2. Download matching chromedriver, e.g., if your version is `123.0.6312.86` then your chromedriver 
must match the major version `123.X.XXXX.XXX`
  1. Driver can be downloaded from [https://googlechromelabs.github.io/chrome-for-testing/](https://googlechromelabs.github.io/chrome-for-testing/)
  2. Navigate to `C:\Users\USER\AppData\Local\binman\binman_chromedriver\win32\` 
and make new directory named as the chromedriver version (e.g., `123.0.6312.86`), save chromedriver and unpack in this location.
  3. Note: It may happen that chromedriver license file would have to be deleted.
3. Make sure you have installed java. If not install it. 
Confirm by `cmd.exe -> java -version (Windows)`
4. Go back to R and run:
  1. for windows it should work without any arguments
  2. on archlinux works with `rD <- RSelenium::rsDriver(chromever = NULL)`

</p>

```{r, warning=FALSE, error=FALSE,  eval=F, echo=T}

library(RSelenium)

rD <- rsDriver()

```

<p align="justify">

If RSelenium sucessfully initiates the browser, then close it and run the package.

</p>

### Run Make_Library command

<p align="justify">

Run the Make_Library command from the script providing link to your personal library:

</p>

```{r,  eval=F, echo=T}

# Scrap the data of the books

URL <- "https://lubimyczytac.pl/ksiegozbior/9YsJPg7kuPc"
num_pages <- <add the number of pages of your library + add extra 2 to number of pages> 
res <- LibBookLC::Make_Library(URL = URL, num_pages = num_pages)

```

<p align="justify">

Once it is finished, you should get a dataframe comprising all the data describing your reading activity.

</p>

### Run Transform_GoodReads_format command

<p align="justify">

If you want to import the dataframe  generated from previous command to the Good reads portal, you need to format them first. Run below command:

</p>

```{r,  eval=F, echo=T}

# Format data for Good reads

good_reads_lib <- Transform_GoodReads_format(raw_data = res,
                           num_books = <type here the amounts of your all book in the library>
                                       )
```

<p align="justify">

After this step you should get a dataframe ready to import for the Good reads portal.

</p>

<p align="justify">

Save the output:

</p>

```{r,  eval=F, echo=T}

# Saving

good_reads_lib <- Transform_GoodReads_format(raw_data = res,
                           num_books = <type here the amounts of your all book in the library>
                                       )
```

## Throubleshooting and final remarks

### License problem

<p align="justify">

If the browser has not been initialized, remove license file from your local binman directory, e.g.,
`C:\UsersUSER\AppData\Local\binman\binman_chromedriver\win32\123.0.6312.86\` and run again.

After it is done, make sure to close driver and/or kill chromedriver and java processes. 

</p>

### Exiting

<p align="justify">

Before running script again, make sure to terminate chromedriver and java processes to release the port. Otherwise you will not be able to initialize script again.

</p>
